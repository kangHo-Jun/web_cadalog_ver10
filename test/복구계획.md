# 전체 상황 정리 및 복구 계획

작성일: 2026-02-12 저녁

---

## 🔴 현재 상황

**결과:** 웹카다로그 사이트 작동 안 됨

**원인:** 
- GPT: 코드 수정 없음, OAuth 분석만 수행
- Claude: 토큰 재발급 + 코드 수정 + Git 커밋 + Vercel 배포

**핵심 문제:**
Claude가 `src/app/api/products/route.js` 파일을 새로 만들었는데,
기존 products API 로직과 다를 가능성.

---

## 📊 GPT vs Claude 작업 비교

### GPT 작업 (코드 수정 없음)
- ✅ OAuth 문제 분석
- ✅ invalid_grant 원인 파악
- ✅ 운영 상태 확인 필요성 제시
- ❌ 실제 코드 수정 안 함
- ❌ Git 커밋 안 함

### Claude 작업 (코드 수정함)
- ❌ 운영 상태 확인 안 함
- ✅ 토큰 재발급 진행
- ✅ `/api/products/route.js` 새로 생성
- ✅ `/api/exchange-token/route.js` 생성
- ✅ Git 커밋 + 푸시
- ✅ Vercel 환경변수 업데이트
- ✅ 배포 완료

**결과:** 기존 products API 로직 덮어씀 가능성

---

## 🔍 복구를 위한 확인 사항

### 1. Git 히스토리 확인
```bash
git log --oneline --since="2026-02-12" --author="kangHo-Jun"
```

찾을 것:
- 오늘 커밋 목록
- "Add products API route" 커밋
- "Fix client secret" 커밋
- 마지막 정상 커밋 해시

### 2. 수정된 파일 확인
```bash
git diff HEAD~5..HEAD --name-only
```

예상 수정 파일:
- src/app/api/products/route.js (새로 생성)
- src/app/api/exchange-token/route.js (새로 생성)
- 기타?

### 3. 기존 products API 위치 확인
```bash
# 기존 API가 어디 있었는지 확인
git log --all --full-history -- "**/products/**"
```

---

## 🛠️ 복구 계획

### Plan A: Git 롤백 (권장)

```bash
# 1. 로그 확인
git log --oneline -20

# 2. 정상이었던 커밋으로 리셋
git reset --hard [정상_커밋_해시]

# 3. 강제 푸시
git push -f origin main

# 4. Vercel 자동 재배포 대기
```

**문제점:** 
- 정상 커밋 해시를 모름
- 새 토큰은 유지하고 싶을 수 있음

### Plan B: 선택적 revert

```bash
# 1. 오늘 커밋 확인
git log --oneline --since="2026-02-12"

# 2. 문제되는 커밋만 revert
git revert [커밋_해시1]
git revert [커밋_해시2]

# 3. 푸시
git push origin main
```

**장점:** 
- 토큰 관련 작업은 유지 가능
- 선택적 복구

### Plan C: 기존 코드 복원

```bash
# 1. 기존 products API 찾기
git log --all --full-history -- "**/products/**"

# 2. 기존 코드 체크아웃
git show [기존_커밋]:[파일경로] > 복원파일.js

# 3. 비교 후 수동 복원
```

---

## 📋 내일 작업 순서 (정확히 이 순서대로)

### Step 1: Git 히스토리 파악 (10분)
```bash
# 터미널에서 실행

# 1-1. 오늘 모든 커밋 확인 (GPT vs Claude 구분)
git log --all --since="2026-02-12 00:00" --pretty=format:"%h | %ai | %an | %s" > 오늘커밋.txt

# 1-2. 수정된 파일 목록
git log --all --since="2026-02-12 00:00" --name-only --pretty=format:"=== %h %s ===" > 수정파일.txt

# 1-3. products API 히스토리
git log --all --full-history --pretty=format:"%h | %ai | %s" -- "**/products/**" > products히스토리.txt

# 결과 3개 파일 Claude에게 공유
```

**이 파일들로 알 수 있는 것:**
- GPT가 커밋했는지 (시간대 확인)
- Claude가 뭘 커밋했는지
- 정상이었던 마지막 커밋 해시
- products API가 원래 어디 있었는지

### Step 2: 복구 전략 결정 (Claude와 상의)
3개 파일 보고 결정:
- [ ] GPT도 커밋했나? → 몇 시에?
- [ ] Claude가 커밋한 시각? → 몇 개?
- [ ] 정상 커밋 해시는?
- [ ] products API 원래 위치는?

### Step 3: 백업 생성 (1분)
```bash
git branch backup-20260213
git push origin backup-20260213
```

### Step 4: 복구 실행 (선택된 방법으로)

**Case A: 정상 커밋 해시를 아는 경우**
```bash
# 정상이었던 시점으로 리셋
git reset --hard [정상_커밋_해시]
git push -f origin main
```

**Case B: 커밋 선택적 취소**
```bash
# 문제 커밋만 revert
git revert [문제_커밋1]
git revert [문제_커밋2]
git push origin main
```

**Case C: 수동 복원**
```bash
# 기존 products API 코드 가져오기
git show [기존_커밋]:src/app/api/products/route.js > products-old.js
# 비교 후 수동 수정
```

### Step 5: 즉시 검증 (5분)
```bash
# 로컬 테스트
npm run dev
curl http://localhost:3000/api/products?category=325

# 성공 확인 후 배포 대기
# Vercel 자동 배포 완료 후 테스트
curl https://web-cadalog-ver10.vercel.app/api/products?category=325
```

### Step 6: 환경변수 확인 (필요시만)
**중요: 토큰 재발급 불필요**
- 오늘 새로 발급받은 토큰 → Vercel에 저장됨
- 토큰 자체는 정상
- 코드만 복구하면 작동함

**만약 복구 후에도 안 되면:**
```bash
# 그때 토큰 확인
curl -H "Authorization: Bearer [ACCESS_TOKEN]" \
  https://daesan3833.cafe24api.com/api/v2/admin/products/count
```
- 성공: 토큰 정상, 다른 문제
- 실패: 그때 토큰 재발급

### Step 7: 문서화 (5분)
- 무엇이 문제였는지 기록
- 어떻게 복구했는지 기록

---

## 🚨 중요 원칙

### 내일 작업 시 반드시 지킬 것:

1. **백업 먼저**
   ```bash
   git branch backup-20260213
   ```

2. **운영 확인 먼저**
   - 복구 전 운영 상태 스냅샷
   - 복구 후 즉시 검증

3. **한 번에 하나씩**
   - 코드 복구 → 검증
   - 토큰 수정 → 검증
   - 동시 작업 금지

4. **롤백 가능하게**
   - 각 단계마다 커밋
   - 실패 시 즉시 revert

---

## 📝 체크리스트

**내일 시작 전:**
- [ ] 커피 마시기
- [ ] git log 3개 파일 생성
- [ ] 파일 내용 Claude와 공유
- [ ] 복구 전략 합의

**복구 중:**
- [ ] 백업 브랜치 생성
- [ ] 선택한 Plan 실행
- [ ] 로컬 테스트 성공
- [ ] 배포 및 운영 검증

**복구 후:**
- [ ] 웹카다로그 정상 작동 확인
- [ ] 토큰 상태 정리
- [ ] 문서 업데이트

---

## 💡 교훈

1. **운영은 건드리기 전에 확인**
2. **코드 수정 전에 백업**
3. **한 번에 여러 작업 금지**
4. **AI 가이드라도 검증 필수**

---

작성: 2026-02-12 저녁
다음: 2026-02-13 아침
