# 카페24 상품 부모-자식 연결 로직 정리

이 문서는 카페24 Admin API에서 가져온 상품 데이터를 부모-자식 구조로 분류하고 그룹화하는 로직을 요약합니다.

## 1. 부모-자식 연결 (Connection)
- **기준**: 상품 코드(`product_code`)의 **앞 8자리**를 부모 코드로 간주합니다.
- **로직**: `parentCode = product_code.substring(0, 8)`
- **예시**: 
  - `P0000CNJ000A` → 부모 코드: `P0000CNJ`
  - `P0000CNJ000B` → 부모 코드: `P0000CNJ`

## 2. 자식 그룹화 (Grouping)
- 동일한 부모 코드(`parentCode`)를 가진 상품 또는 품목(variants)을 하나의 그룹으로 묶습니다.
- **데이터 필터링**: 카테고리별로 호출된 모든 상품 데이터에서 부모 코드가 일치하는 것들을 수집합니다.
- **중복 제거**: 동일한 `product_no`를 가진 상품이 여러 번 호출될 경우 중복을 제거합니다.

## 3. 부모 상품 출력 (Parent Output)
- **출력 명칭**: 해당 그룹 내 첫 번째 상품의 `product_name`을 사용하되, **정규화(Normalization)** 과정을 거칩니다.
- **정제 로직 (`normalizeProductName`)**:
  - HTML 태그 (`<br>` 등) 제거
  - `&nbsp;` 등 특수문자 공백화
  - 규격 정보(`x`) 또는 괄호(`(`) 이전의 핵심 이름만 추출
  - 연속된 공백 정리
- **표시 영역**: 카탈로그 리스트에서 섹션 헤더 또는 그룹 타이틀 역할을 하며, **부모당 단 한 번만 출력**됩니다.

## 4. 자식 상품 출력 (Child Output)
- **출력 대상**: 부모 그룹에 속한 개별 품목(`variants`) 데이터를 자식 상품으로 처리합니다.
- **필수 필드**:
  - `variant_code`: 품목 고유 코드
  - `options`: 품목별 옵션 정보 (예: 규격, 색상 등)
  - `price` / `additional_amount`: 품목별 추가 금액 및 가격 정보
- **표시 영역**: 부모 그룹 하위의 테이블 행 또는 리스트 아이템으로 출력됩니다.

## 5. 요약 아키텍처
1. **API 호출**: `apiClient.get('/products', { params: { embed: 'variants' } })`
2. **코드 파싱**: 각 상품의 `product_code` 추출 및 8자리 절삭.
3. **맵 구성**: `Map<ParentCode, { parentName, children: [] }>` 형태로 가공.
4. **결과 저장**: 가공된 데이터를 Redis에 스냅샷 형태로 저장하여 프론트엔드에 즉시 제공.
