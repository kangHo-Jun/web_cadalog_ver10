# Cafe24 카테고리 구조 분석

## [실제 Cafe24 구조]

### URL 기반 카테고리 번호
```
https://daesan3833.cafe24.com/product/list.html?cate_no=192  (합판/MDF)
https://daesan3833.cafe24.com/product/list.html?cate_no=50   (석고보드)
```

### categories_data.js 기록 (기존 DB 구조)
```javascript
{ "category_no": 50, "category_name": "석고보드" }
{ "category_no": 26, "category_name": "단열재" }
{ "category_no": 25, "category_name": "각재/목재" }
```

### 확인 불가 항목
- `cate_no=192`의 `category_depth` 값: **확인 불가** (API 응답 데이터 없음)
- `cate_no=192`의 `parent_category_no`: **확인 불가**
- `cate_no=50`의 `category_depth` 값: **확인 불가**
- `cate_no=50`의 `parent_category_no`: **확인 불가**
- 각 카테고리의 상위 루트 `category_no`: **확인 불가**

### API 응답 상태
- `categories_dump.json`: 빈 파일 (0 bytes)
- `/api/categories` 엔드포인트: 서버 실행 중이나 응답 미확인
- Cafe24 API 직접 호출: 인증 토큰 필요 ([api-client.ts](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/lib/api-client.ts#L5))

---

## [현재 하드코딩 구조]

### QUOTE_CATEGORIES 배열 ([quote-categories.ts](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/config/quote-categories.ts))

#### 대분류 (depth=1, parent=null)
```javascript
{ category_no: 325, category_name: '단열재(견적서)', display_name: '단열재' }
{ category_no: 326, category_name: '석고보드(견적서)', display_name: '석고보드' }
{ category_no: 327, category_name: '각재/목재(견적서)', display_name: '각재/목재' }
{ category_no: 328, category_name: '합판/MDF(견적서)', display_name: '합판/MDF' }
{ category_no: 329, category_name: '방부목/데크(견적서)', display_name: '방부목/데크' }
{ category_no: 330, category_name: '집성목/계단(견적서)', display_name: '집성목/계단' }
{ category_no: 331, category_name: '철물/부자재(견적서)', display_name: '철물/부자재' }
```

#### 중분류 (depth=2, parent=327)
```javascript
{ category_no: 332, category_name: '소송(견적서)', parent_category_no: 327 }
{ category_no: 333, category_name: '뉴송(견적서)', parent_category_no: 327 }
```

### 분류 기준
- `category_depth: 1` + `parent_category_no: null` → 대분류
- `category_depth: 2` + `parent_category_no: 327` → 중분류

---

## [차이점]

### 1. 카테고리 번호 불일치

| 카테고리명 | 실제 Cafe24 (추정) | 하드코딩 구조 | 일치 여부 |
|-----------|-------------------|--------------|----------|
| 석고보드 | 50 | 326 | ❌ |
| 단열재 | 26 | 325 | ❌ |
| 각재/목재 | 25 | 327 | ❌ |
| 합판/MDF | 192 (URL 기반) | 328 | ❌ |

### 2. 구조 체계 차이

#### 실제 Cafe24
- **필드명**: `cate_no` (URL 파라미터)
- **번호 범위**: 25, 26, 50, 192 등 (불규칙)
- **계층 구조**: 확인 불가

#### 하드코딩 구조
- **필드명**: `category_no` (TypeScript 인터페이스)
- **번호 범위**: 325-333 (연속)
- **계층 구조**: `category_depth` + `parent_category_no` 기반 명시적 트리 구조

### 3. 데이터 출처

#### 실제 Cafe24
- Cafe24 API: `/api/v2/admin/categories`
- 응답 필드: `category_no`, `category_name`, `category_depth`, `parent_category_no` (추정)
- 현재 상태: API 응답 데이터 없음

#### 하드코딩 구조
- 정적 파일: `src/config/quote-categories.ts`
- 수동 등록: 주석에 "표시안함으로 설정된 카테고리는 API로 조회되지 않아 수동으로 등록" 명시
- 업데이트: 코드 수정 필요

### 4. API 호출 방식

#### 실제 Cafe24 API
```javascript
// categories/route.ts Line 30-35
apiClient.get('/categories', {
  params: { depth: 1, limit: 100 }
})
```

#### 하드코딩 구조 사용
```javascript
// categories/route.ts Line 16-26
if (type === 'quote') {
  return NextResponse.json({ categories: QUOTE_CATEGORIES })
}
```

### 5. parent_category_no 기반 트리 구성

#### 하드코딩 구조
- **가능**: `mapSubCategories()` 함수로 `parent_category_no` 기반 필터링 ([category-mapper.ts:L24](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/utils/category-mapper.ts#L24))
- **구현**: `categories.filter(cat => cat.parent_category_no === selectedRootCategoryNo)`

#### 실제 Cafe24
- **가능 여부**: 확인 불가 (API 응답 데이터 없음)
- **전제 조건**: Cafe24 API가 `parent_category_no` 필드를 반환해야 함

---

## [코드 기반 사실]

### API 엔드포인트 분기 ([categories/route.ts](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/app/api/categories/route.ts))
```javascript
// Line 16-26: type=quote → 하드코딩 반환
if (type === 'quote') {
  return NextResponse.json({ categories: QUOTE_CATEGORIES })
}

// Line 30-35: type 없음 → Cafe24 API 호출
const response = await apiClient.get('/categories', {
  params: { depth: 1, limit: 100 }
})
```

### 상품 API 호출 ([products/route.ts](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/app/api/products/route.ts))
```javascript
// Line 21-28: QUOTE_CATEGORY_NOS 배열로 순회
categoryNos.map(catNo =>
  apiClient.get('/products', {
    params: {
      category: catNo,  // 325, 326, 327... 사용
      selling: 'T',
      limit: 100
    }
  })
)
```

### 중분류 필터링 ([category-mapper.ts](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/utils/category-mapper.ts))
```javascript
// Line 24: parent_category_no 기반 필터링
const children = categories.filter(
  cat => cat.parent_category_no === selectedRootCategoryNo
)
```

---

## [결론]

### 확인된 사실
1. **URL 파라미터**: `cate_no=192`, `cate_no=50` 사용
2. **categories_data.js**: 25, 26, 50 번호 기록
3. **QUOTE_CATEGORIES**: 325-333 번호 사용
4. **번호 불일치**: 실제 Cafe24 번호와 하드코딩 번호가 완전히 다름
5. **API 분기**: `type=quote` 파라미터로 하드코딩/실제 API 선택

### 확인 불가 항목
1. Cafe24 API 실제 응답 구조
2. `cate_no=192`, `cate_no=50`의 `category_depth`, `parent_category_no` 값
3. 실제 Cafe24 카테고리 트리 구조
4. 하드코딩 번호(325-333)와 실제 번호(25, 26, 50, 192)의 매핑 관계
