# 견적서 카테고리 로직 분석 보고서 (Logic Analysis Report)

본 문서는 `web_cadalog_ver10` 프로젝트의 견적서 전용 카테고리(325~333)의 구조와 UI 로직에 대한 코드 기반 분석 결과입니다.

---

## 1. 대분류 정의 방식 (Root Category Definition)
- **정의 기준**: `QUOTE_CATEGORIES` 배열 내에서 `category_depth: 1`이며 `parent_category_no`가 `null` 또는 `undefined`인 항목.
- **필터링 위치**:
    - [CategorySection.tsx:L26](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/CategorySection.tsx#L26): `categories.filter(cat => cat.category_depth === 1)`
    - [QuoteCatalog.tsx:L151-156](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/QuoteCatalog.tsx#L151-156): `isRootCategoryNo()` 헬퍼 함수.
- **데이터 소스**: [quote-categories.ts](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/config/quote-categories.ts)

## 2. 중분류 생성 및 노출 로직 (Sub-Category Logic)
- **트리거(Trigger)**: 대분류 탭 클릭 시 `handleCategoryChange` 함수 실행.
- **데이터 매핑**: `mapSubCategories(QUOTE_CATEGORIES, catNo)`를 호출하여 부모 번호가 일치하는 자식 카테고리를 필터링.
    - [category-mapper.ts:L17](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/utils/category-mapper.ts#L17)
- **상태 관리(State Management)**:
    - `setSelectedCategory(catNo)`: 대분류 ID 갱신.
    - `setSelectedSubCategory(null)`: 중분류 초기화.
    - `setSubCategories(nextSubCategories)`: 중분류 리스트 저장.
- **UI 렌더링**: `CategorySection` 컴포넌트 하단에 칩(Chip) 형태로 노출.

## 3. 상품 연결 방식 (Product Connection)
- **활성 카테고리 결정(Active ID)**: `selectedSubCategory || selectedCategory`
    - 중분류가 선택된 경우 중분류 ID를, 없는 경우 대분류 ID를 최종 `category`로 선택.
- **상품 API 호출**:
    ```typescript
    // src/components/QuoteCatalog.tsx:L403
    const productKey = `/api/products?type=${mode}&keyword=${debouncedSearch}&category=${activeCategoryNo || ''}`;
    ```
- **데이터 구조**: 서버 API는 단일 `category` 번호만 수신하며, 클라이언트가 결정한 depth 1 또는 2의 번호를 기준으로 검색 수행.

## 4. 데이터 흐름 (Data Flow Summary)
1. **Event**: 사용자가 `CategorySection`의 버튼 클릭.
2. **State Transition**: `QuoteCatalog` 컴포넌트의 카테고리 상태값 업데이트.
3. **Key Update**: SWR Hook의 `productKey`가 반응형으로 변경.
4. **Data Fetching**: 갱신된 URL로 `GET /api/products` API 요청 발생.
5. **UI Sync**: 받아온 상품 리스트(`prodData`)를 `ProductList`가 렌더링.

---
**작성일**: 2026-02-12
**작성자**: Antigravity Senior Engineer
