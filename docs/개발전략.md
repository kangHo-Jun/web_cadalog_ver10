# 개발 전략 문서

작성일: 2026-02-13

---

## 📋 개발 목적

**현재 구조:**
- 대분류 → 중분류 → 상품 리스트

**목표 구조:**
- 대분류 → 부모상품 테이블 → 클릭 시 옵션상품 노출

---

## 🎯 핵심 요구사항

### 1. 데이터 구조
- **부모상품**: 상품코드 8자리 (예: P0000CHJ)
- **아들상품**: 품목코드 = 부모코드 + 접미사 (예: P0000CHJ000A)
- **그룹핑**: variant_code 앞 8자리 기준

### 2. 화면 출력
**테이블 초기 상태:**
- 부모상품명만 표시
- 옵션 없는 상품도 포함

**클릭 시:**
- 아들상품 목록 확장
- 품목명 + 가격 + 수량 선택 + 견적 담기

### 3. 예시
```
부모: 프리미엄 단열재 PF보드LX지인 (P0000CHJ)
  ├─ 30T x 1000 x 1800  18,150원  [수량] [담기]
  ├─ 50T x 1000 x 1800  26,400원  [수량] [담기]
  └─ 90T x 1000 x 1800  47,300원  [수량] [담기]
```

---

## 🔧 기술 전략

### Phase 1: 데이터 수집
- Cafe24 Admin API 사용
- embed=variants로 품목코드 포함 조회
- 카테고리 325~333 전체 상품

### Phase 2: 데이터 가공
- variant_code 앞 8자리로 그룹핑
- 부모상품: 상품명, 상품코드
- 아들상품: 품목명, 품목코드, 가격

### Phase 3: 스냅샷 생성
- `/api/sync-products` 엔드포인트
- ~~JSON 파일 저장: `public/products-snapshot.json`~~
- **Redis 저장** (Vercel Serverless 환경에서 파일 저장 불가)
- Key: `products_snapshot`
- 구조:
```json
{
  "P0000CHJ": {
    "parentName": "프리미엄 단열재 PF보드LX지인",
    "children": [
      {
        "variantCode": "P0000CHJ000A",
        "variantName": "30T x 1000 x 1800",
        "price": "18150"
      }
    ]
  }
}
```

**중요 확인사항:**
- ✅ variant_code는 항상 8자리 prefix 구조 확인됨
- ⚠️ API 가격 정보 없음 (모두 0.00) → 엑셀 데이터 필요
- ✅ Vercel은 read-only 환경 → Redis 사용 필수

### Phase 4: 자동 갱신
- Vercel Cron Jobs
- 매시간 또는 하루 1회
- `/api/cron/sync-products`

### Phase 5: UI 구현
- ProductTable 컴포넌트
- Accordion 또는 expandable row
- 중분류 제거

---

## 📁 파일 구조

```
/api/sync-products/route.ts    # 스냅샷 생성 API (Redis 저장)
/api/cron/sync-products/route.ts  # Cron 작업
/utils/product-grouper.ts       # 그룹핑 로직
/components/ProductTable.tsx    # 새 테이블 UI
/lib/redis-storage.ts           # Redis 저장소 헬퍼
```

---

## ⚠️ 주의사항

1. **Vercel 환경변수 건드리지 않기**
   - 토큰 갱신 시 로컬에서만
   - 운영 배포 전 충분한 테스트

2. **기존 기능 유지**
   - 롤백 가능하도록 브랜치 분리
   - 기존 ProductList 백업

3. **데이터 검증**
   - 그룹핑 로직 테스트
   - 옵션 없는 상품 처리 확인

4. **가격 데이터 문제** ⚠️
   - Admin API에서 모든 상품 가격이 0.00
   - 해결 방법:
     - 수동: 엑셀 다운로드 → JSON 변환 → Redis 저장
     - 자동: Puppeteer로 엑셀 자동 다운로드 (복잡)
   - 당분간 수동 업데이트 필요

5. **저장소 제약**
   - Vercel Serverless는 파일 쓰기 불가
   - Redis 사용 필수
   - Redis 용량 제한 확인 필요

---

## 🚀 구현 순서

1. ✅ Admin API 테스트 완료
2. ✅ variant_code 확인 완료
3. ⬜ 스냅샷 API 개발
4. ⬜ 그룹핑 로직 개발
5. ⬜ UI 컴포넌트 개발
6. ⬜ Cron 작업 설정
7. ⬜ 테스트 및 배포

---

작성: 2026-02-13
