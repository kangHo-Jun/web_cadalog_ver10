# 웹카탈로그 출력 구조 분석

## 1. 데이터 구조

### 대분류
- **API 필드명**: `category_no`, `category_name`, `display_name`, `category_depth`, `parent_category_no`
- **DB 구조**: Cafe24 API 응답 (실제 DB 구조 확인 불가)
- **참조 위치**: `/src/config/quote-categories.ts` (하드코딩된 정적 배열)

### 중분류
- **API 필드명**: `category_no`, `category_name`, `display_name`, `category_depth`, `parent_category_no`
- **DB 구조**: Cafe24 API 응답 (실제 DB 구조 확인 불가)
- **참조 위치**: `/src/config/quote-categories.ts` (하드코딩된 정적 배열)

### 옵션
- **API 필드명**: `product_code`의 마지막 문자를 제외한 prefix로 그룹핑
- **DB 구조**: 상품 데이터 내 `product_code` 필드 활용
- **참조 위치**: `/src/components/catalog/ProductList.tsx` 내 `getGroupKey()` 함수

---

## 2. 출력 로직

### 대분류 렌더링 방식
- **컴포넌트**: [CategorySection.tsx](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/CategorySection.tsx#L31-L46)
- **필터링**: `categories.filter(cat => cat.category_depth === 1)` (Line 26)
- **렌더링**: `rootCategories.map()` 반복문으로 버튼 생성
- **선택 상태**: `selectedCategoryId === category.category_no` 조건으로 스타일 변경

### 중분류 렌더링 방식
- **컴포넌트**: [CategorySection.tsx](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/CategorySection.tsx#L59-L72)
- **필터링**: `mapSubCategories(QUOTE_CATEGORIES, selectedRootCategoryNo)` 함수 호출 ([category-mapper.ts:L17-33](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/utils/category-mapper.ts#L17-L33))
- **조건**: `cat.parent_category_no === selectedRootCategoryNo` (category-mapper.ts Line 24)
- **렌더링**: `subCategories.map()` 반복문으로 버튼 생성
- **애니메이션**: framer-motion의 `AnimatePresence` 사용 (Line 50-75)
- **선택 상태**: `selectedSubCategoryId === sub.category_no` 조건으로 스타일 변경

### 옵션 렌더링 방식
- **컴포넌트**: [ProductList.tsx](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/catalog/ProductList.tsx#L181-L257)
- **트리거**: 테이블 행 클릭 시 `handleRowClick()` 실행 (Line 63-67)
- **그룹핑**: `product_code.slice(0, -1)` 로 그룹 키 생성 (Line 38)
- **저장**: `overlayGroupKey` state에 그룹 키 저장
- **렌더링**: 고정 위치 오버레이 모달 (`fixed inset-0 z-50`, Line 182)
- **데이터**: `groupedProducts.map.get(overlayGroupKey)` 배열 순회 (Line 59-61, 194-253)

---

## 3. 사용 기법

### 상태관리
- **라이브러리**: React `useState` hook
- **대분류**: `selectedCategory` ([QuoteCatalog.tsx:L90](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/QuoteCatalog.tsx#L90))
- **중분류**: `selectedSubCategory` ([QuoteCatalog.tsx:L91](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/QuoteCatalog.tsx#L91))
- **중분류 목록**: `subCategories` ([QuoteCatalog.tsx:L92](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/QuoteCatalog.tsx#L92))
- **옵션 오버레이**: `overlayGroupKey` ([ProductList.tsx:L34](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/catalog/ProductList.tsx#L34))

### 필터링 방식
- **대분류**: `category_depth === 1` 조건 ([CategorySection.tsx:L26](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/CategorySection.tsx#L26))
- **중분류**: `parent_category_no === selectedRootCategoryNo` 조건 ([category-mapper.ts:L24](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/utils/category-mapper.ts#L24))
- **옵션**: `product_code` prefix 기반 `Map` 자료구조 ([ProductList.tsx:L43-56](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/catalog/ProductList.tsx#L43-L56))

### 매핑 방식
- **대분류→중분류**: `mapSubCategories()` 유틸 함수 ([category-mapper.ts:L17-33](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/utils/category-mapper.ts#L17-L33))
- **상품→옵션**: `useMemo`로 `Map<string, Product[]>` 생성 ([ProductList.tsx:L43-57](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/catalog/ProductList.tsx#L43-L57))

### API 호출 방식
- **라이브러리**: `useSWR`
- **카테고리**: `/api/categories?type=quote` ([QuoteCatalog.tsx:L269](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/QuoteCatalog.tsx#L269))
- **상품**: `/api/products?type=${mode}&keyword=${debouncedSearch}&category=${activeCategoryNo}` ([QuoteCatalog.tsx:L403](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/QuoteCatalog.tsx#L403))
- **Revalidation**: `revalidateOnFocus: true`, `dedupingInterval: 2000` (Line 408-410)

### 캐싱 여부
- **SWR 자동 캐싱**: `dedupingInterval: 60000` (카테고리), `2000` (상품)
- **수동 캐싱**: 없음

### 컴포넌트 구조
- **최상위**: [QuoteCatalog.tsx](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/QuoteCatalog.tsx)
- **대분류/중분류**: [CategorySection.tsx](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/CategorySection.tsx)
- **상품 목록**: [catalog/ProductList.tsx](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/catalog/ProductList.tsx)
- **옵션 오버레이**: [ProductList.tsx](file:///Users/zart/Documents/프로젝트/Antigravity_Project/web_cadalog_ver10/src/components/catalog/ProductList.tsx#L181-L257) 내부 조건부 렌더링

---

## 4. 데이터 흐름

```
QUOTE_CATEGORIES (정적 배열)
    ↓
CategorySection (대분류 필터링: depth === 1)
    ↓
사용자 대분류 선택
    ↓
mapSubCategories() (중분류 필터링: parent_category_no 일치)
    ↓
CategorySection (중분류 렌더링)
    ↓
사용자 중분류 선택 (선택적)
    ↓
API 호출: /api/products?category={activeCategoryNo}
    ↓
ProductList (상품 목록 렌더링)
    ↓
사용자 행 클릭
    ↓
getGroupKey() (product_code 기반 그룹핑)
    ↓
오버레이 모달 (옵션 목록 렌더링)
```
