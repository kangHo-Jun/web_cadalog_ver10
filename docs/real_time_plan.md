진행 중인 **cafe24-web-catalog** 프로젝트의 실시간 동기화 전략을 한눈에 파악하기 좋은 **기술 보고서(Technical Report)** 형식으로 정리해 드립니다.

---

# [보고서] Cafe24 웹 카탈로그 실시간 동기화 전략

## 1. 개요 및 목적

본 문서는 Cafe24 Admin API와 연동된 웹 카탈로그 시스템의 데이터 정합성을 확보하고, 실시간성(Real-time)을 강화하기 위한 단계별 기술 전략을 제시합니다.

## 2. 현황 및 문제점 분석

* **기술 스택**: Next.js 15(App Router), React 19 기반의 최신 아키텍처를 사용 중입니다.
* **현재 구조**: API Proxy 패턴을 통해 Cafe24 API와 통신하며, 자동 토큰 갱신 메커니즘이 구현되어 있습니다.
* **위험 요소**:
* Next.js 15의 서버 사이드 캐싱으로 인해 Cafe24 어드민의 변경 사항이 즉시 반영되지 않을 가능성이 있습니다.
* `ProductTable.tsx` 컴포넌트가 541라인에 달해 데이터 갱신 시 렌더링 성능 저하가 우려됩니다.



## 3. 실시간 동기화 4단계 로드맵

### 1단계: 서버 사이드 캐시 제어 (Immediate)

* **강제 동적 렌더링**: API Route에 `force-dynamic` 설정을 적용하여 모든 요청이 캐시를 우회하고 실시간으로 API를 호출하도록 합니다.
* **헤더 최적화**: `Cache-Control: no-store` 설정을 통해 브라우저 수준의 캐싱을 차단합니다.

### 2단계: 클라이언트 상태 관리 최적화 (Short-term)

* **라이브러리 도입**: SWR 또는 TanStack Query를 도입하여 데이터 신선도를 관리합니다.
* **자동 갱신 설정**: 사용자가 브라우저 탭을 다시 활성화할 때(Focus) 데이터를 자동으로 재조회하는 기능을 활성화합니다.

### 3단계: 이벤트 기반 웹훅 연동 (Current)

*   **Webhook API 구현**: `src/app/api/webhook/cafe24/route.ts` 엔드포인트를 통해 상품 수정(`product.update`) 이벤트를 실시간으로 수신합니다.
*   **온디맨드 갱신**: 웹훅 수신 시 Next.js의 `revalidatePath`를 호출하여 서버 데이터를 즉시 최신화합니다.
*   **Cafe24 설정 방법**:
    1.  [Cafe24 Developers](https://developers.cafe24.com/) 로그인
    2.  앱 관리 > 서비스 설정 > 웹훅(Webhook) 설정 이동
    3.  엔드포인트 URL에 `https://{your-domain}/api/webhook/cafe24` 등록
    4.  구독할 이벤트로 `상품 수정`, `상품 등록` 선택

### 4단계: 컴포넌트 리팩토링 및 검증 (Long-term)

* **원자화(Atomization)**: 비대한 `ProductTable.tsx`를 기능별 컴포넌트로 분리하여 리렌더링 범위를 최소화합니다.
* **자동화 테스트**: Cafe24 어드민 데이터와 카탈로그 데이터의 일치 여부를 검증하는 테스트 코드를 작성합니다.

## 4. 기대 효과 및 결론

* **신뢰성 확보**: 고객에게 항상 최신의 상품 가격과 재고 정보를 제공하여 견적 오차를 방지합니다.
* **보안 강화**: API Proxy 패턴을 유지하며 실시간성을 확보하여 시스템 안정성을 높입니다.
* **확장성**: 향후 멀티 쇼핑몰 지원 및 AI 기반 추천 시스템 도입을 위한 견고한 데이터 기반을 마련합니다.

---

이 보고서에 기술된 **3단계(Webhook 연동)** 기초 구현을 완료했습니다. 이제 실제 서비스 도메인이 연결되면 카페24 관리자 화면의 변경사항이 실시간으로 반영됩니다.